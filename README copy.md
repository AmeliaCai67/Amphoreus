# README

## 项目背景

- 本项目基于游戏《崩坏星穹铁道》3.4版翁法罗斯主线剧情中，角色来古士的实验。尝试结合生成式人工智能的multi-agent交互框架，还原delta-me-13 （即翁法罗斯本体）的演算，复现部分游戏设定
- 由于技术所限，本项目不可能完全还原游戏设定，仅模拟白厄杀死昔涟后的33550336次循环迭代（即第二次逐火之旅“永劫回归”）
- 本项目属于游戏二次创作，严禁商用，部分提示词来自游戏文本，版权归米哈游所有
- 仅供娱乐，请勿过度解读

## 实验思路

- 使用12个ai agent模拟十二黄金裔，并在其系统提示词中写入【因子】，例如毁灭、诡计
- 构建交互环境，让agent交互产生数据，【火种】为某一agent日志的全部数据
- 交互环境中存在若干checkpoint，例如是否保留火种，是否杀死同伴，agent基于记忆和参数（利己vs利他，对极端行为例如杀人的容忍程度）进行选择，选项固定
- 满足一定的判定条件，例如火种全部归还，则进入下一轮迭代；本轮产生的数据作为下一轮迭代的背景信息（以神话传说的方式）
- 创世涡心为一个存档【火种】+ 初始化迭代的cache，按照游戏剧情，第二次逐火之旅火种未归还至创世涡心，故每次初始化同样的角色

## 预言与记忆机制设计

- 本项目引入“神谕预言”与“铭文”系统，作为每位黄金裔角色的背景注释，用以模拟神话层级的叙事风格。每位角色拥有预设铭文（可视为角色自我认知）与预言（来自创世AI或来古士的神谕记录）。
- 在每轮交互中，系统将根据角色当前状态（火种持有量、选择倾向、疲惫度等）选择是否触发“预言片段”，作为迭代叙事的一部分，存入agent日志。
- 预言具有非线性触发属性，旨在引导交互生成出“循环叙事”的象征意义，同时推动玩家理解每一轮是否存在“轮回的例外”。
- 例如：“天空之子将缝补晨昏”“你所播种的种子已在发芽”等预言，将出现在关键checkpoint后，作为提示与叙事扩展。
- 后续可扩展“预言堆叠记忆”机制，模拟黄金裔因记忆重负出现的行为裂变。

## 角色扩展与设计来源

- 黄金裔共12位，参考官方设定与社区讨论补全，包括阿格莱雅（浪漫）、缇宝（门径）、万敌（纷争）、风堇（天空）、刻律德菈（律法）、遐蝶（死亡）、昔涟（岁月）、那刻夏（理性）、赛飞儿（诡计）、白厄（负世）等。
- 每位角色在初始化时加载以下参数：
  - 路径（Path）：决定其决策框架
  - drive（Drive）：模拟角色意志方向
  - 铭文（Inscription）：代表角色行为风格与语气
  - 预言（Oracle）：由系统选择性投放的命运片段
- JSON数据支持结构化管理角色状态，用于日志生成与循环叠代的可追溯性。

## 代码构成

## 火种可视化

- 每个agent在迭代过程中生成的日志（即“火种”）可被结构化为可视图像，用于分析其选择路径、情绪波动、记忆权重变化等指标。
- 当前版本支持使用matplotlib或Plotly进行时间序列图、分叉树、情绪热图等形式的可视化。
- 后续将探索基于Web界面的交互式火种回溯工具，支持玩家追踪黄金裔的命运分支。

## 预言触发概率计算

- 预言的触发基于角色当前状态（如疲惫度、火种密度、行为偏移）与事件上下文。
- 每条预言具有权重（base_weight）与上下文因子（context_factor），用于控制其被引用的概率：

  ```plaintext
  trigger_score = base_weight * context_factor * randomness
  ```

- 系统在关键checkpoint后进行一次采样，根据得分决定是否插入“神谕式提示”。

### 角色初始化和日志记录

每位黄金裔的初始化由角色配置文件（JSON/YAML）控制，加载包括：路径（path）、drive（drive）、铭文（inscription）、预言（oracle）等基础信息，并绑定至对应的agent实例。

agent初始化流程如下：

- 读取角色配置文件，构造Agent类
- 注册角色路径与因子（以系统提示词嵌入）
- 初始化火种缓存区（可为日志列表或memory token window）
- 初始化疲惫度、记忆压缩参数等状态变量

日志记录采用周期轮询机制进行，每轮交互后自动记录：

- 当前输入输出内容
- 所触发的预言或铭文（若有）
- 决策选项及其动因（如打分向量）
- 当前火种积累状态（用于可视化）
- 火种密度与持有度（用于判断下一轮流向）

所有日志最终写入火种存档，用于轮回后的“记忆遗传”过程。

#### 基座模型配置

支持自定义大语言模型或API（如 OpenAI GPT-4、Claude、glm、通义千问等）。用户需配置：

- 模型名称与访问方式
- context_window（建议 >=8k）
- temperature、top_p等采样参数
- prompt模板（包括路径注入方式）

#### “路径”“drive”

每条路径映射为一组行为权重矩阵，影响agent在面对相同行动选项时的偏好倾向。drive为路径下的偏微调因子，用于构造 agent 的自我动机模型。

例如：

- 路径为“理性” → 更倾向逻辑性选择（冷漠）
- drive为“救赎” → 即使冷漠也可能在关键事件中转向利他

#### agent交互日志与“火种”

火种即为agent行为日志的封装，是交互过程的核心数据载体。火种中每一条记录包括：

- agent观察到的世界状态
- 选择历史
- 触发的预言及记忆片段
- 内部“反思”或自我反馈（如模拟CoT）

后续将火种作为embedding输入用于“轮回继承”与agent自我演化。

### 交互环境和checkpoint

#### 模拟环境和NPC

交互环境由主控Agent（如来古士）协调，负责发布事件、调度角色及记录全局状态。NPC行为支持两种方式：

- 静态响应（根据预设规则）
- mini-agent（拥有简化版路径/drive，可对agent选择进行扰动）

#### checkpoints

Checkpoint是推动世界线前进的关键机制，每轮迭代固定设置数个节点，例如：

- 是否保留火种
- 是否杀死同伴
- 是否相信NPC发布的判断
- 是否提议轮回结束

每个checkpoint会依据agent当前状态进行行为预测与冲突判定，产生选择分叉。

### “火种”和创世涡心

#### “再创世”条件

系统设定多个“重启判据”，当满足如下任一条件时，将进入新一轮轮回：

- 火种全部归还
- 至少一名黄金裔杀死所有其余成员
- 火种遗传至“污染状态”导致涡心拒绝接受

#### 创世涡心

涡心保存以下内容：

- 上一轮中归还的火种日志（可供下一轮agent访问）
- Agent初始状态Hash值
- 每轮迭代统计数据（决策偏差、火种分布、预言激活率等）

后续版本考虑以数据库形式保存涡心状态，支持多人共创式模拟。

### 白厄传火机制

白厄拥有“强制传火”权限，即可以在任意节点“点燃”某个agent，引发记忆短接与选择转变。此机制用于模拟强干预条件。

### 侵入变量（开拓者和丹恒）的模拟

支持引入“外部干涉者”，如模拟玩家角色（开拓者）与特殊变量（丹恒·饮月），以配置文件形式设定：

- 可操控的轮次与对象
- 特殊话语权与决策劫持概率
- 向某agent注入信息片段的能力（如注入真实历史）

干涉者行为将在日志中标注，避免与黄金裔本身行为混淆。
